<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="matsim">
<title>Example project • matsim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example project">
<meta property="og:description" content="matsim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">matsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Exampleproject.html">Example project</a>
    <a class="dropdown-item" href="../articles/Introduction.html">Introduction to MATSim R Library: analyzing transport simulations</a>
    <a class="dropdown-item" href="../articles/Namings.html">Namings</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/matsim-vsp/matsim-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example project</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/matsim-vsp/matsim-r/blob/HEAD/vignettes/Exampleproject.Rmd" class="external-link"><code>vignettes/Exampleproject.Rmd</code></a></small>
      <div class="d-none name"><code>Exampleproject.Rmd</code></div>
    </div>

    
    
<p>The data used in this example project can be found on the [public
repository] (<a href="https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/" class="external-link uri">https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/</a>)
from VSP Berlin. There you can also find other MATSim scenarios.</p>
<div class="section level4">
<h4 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
<p>This vignette offers an example workflow from MATSim output to
thematic plots and maps. For a general overview of the package and its
structure please read the introduction.</p>
<p>A short recap however: functions are divided into four categories and
start with a respective prefix. Read_, process_, plot_ or compare_ and
in the future simwrapper_. To better understand the naming conventions
(for example to create your own functions) consult this vignette
[LINK].</p>
</div>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>MATSim R is not yet available at CRAN, so to install MATSim R using
github, use the following code.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"matsim-vsp/matsim-r"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="loading-the-package">Loading the package<a class="anchor" aria-label="anchor" href="#loading-the-package"></a>
</h4>
<p>Once installed, you can load the MATSim R package using the library()
function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/matsim-vsp/matsim-r" class="external-link">matsim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h4>
<p>The data we’ll use in this example project is the result of a Leipzig
run which you can find under the following link. (<a href="https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/leipzig/projects/namav/base-case/" class="external-link uri">https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/leipzig/projects/namav/base-case/</a>)</p>
<p>If you want to follow along, download a copy of the folder.</p>
<p>To start, we will load the output_trips.csv.gz file. It is a zipped
file, but that is okay, the functions can handle that. We will also load
a shape file, which can be found here. (<a href="https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/leipzig/leipzig-v1.1/input/shp/" class="external-link uri">https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/leipzig/leipzig-v1.1/input/shp/</a>)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">trips_file_path</span> <span class="op">&lt;-</span> <span class="st">"paste_file_path_here"</span></span>
<span> </span>
<span> <span class="co"># if you don't want to immediately load the whole file, the function read_output_trips has the option to only load the first n lines </span></span>
<span> <span class="va">output_trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_output_trips.html">read_output_trips</a></span><span class="op">(</span><span class="va">trips_file_path</span>, n_max <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="plot-a-modal-split">Plot a modal split<a class="anchor" aria-label="anchor" href="#plot-a-modal-split"></a>
</h4>
<p>There are two functions to calculate and plot modal splits:
<code><a href="../reference/plot_mainmode_piechart.html">plot_mainmode_piechart()</a></code> and
<code><a href="../reference/plot_mainmode_piechart.html">plot_mainmode_piechart()</a></code>. As the name suggests the first
one plots the modal split as a pie chart and the second one as a bar
chart. To do this, they use the processing function
<code><a href="../reference/process_get_mainmode_distribution.html">process_get_mainmode_distribution()</a></code> and plot the resulting
table. The processing function can also be used on its own to just get
the raw numbers.</p>
<p>We are going to plot a bar chart:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/plot_mainmode_barchart.html">plot_mainmode_barchart</a></span><span class="op">(</span><span class="va">output_trips</span><span class="op">)</span></span></code></pre></div>
<p>The resulting bar chart looks like this:</p>
<div class="figure">
<img src="Leipzig_modal_split.png" alt=""><p class="caption">Leipzig modal split</p>
</div>
</div>
<div class="section level4">
<h4 id="spatial-filter">Spatial filter<a class="anchor" aria-label="anchor" href="#spatial-filter"></a>
</h4>
<p>In a next step we want to spatially filter our data. So far we have
been looking at all the trips in the simulation, now we want to focus on
those that touch our project area.</p>
<p>To do this we can use the function
<code><a href="../reference/process_filter_by_shape.html">process_filter_by_shape()</a></code> and the shape file we’ve already
loaded. The parameter <code>crs</code> is the coordinate system number
and the spatial_type describes the way the trips interact with the
project area. The four options are inside, outside, originating and
destinating. In this case we will look at the originating trips.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trips_originating</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_filter_by_shape.html">process_filter_by_shape</a></span><span class="op">(</span><span class="va">output_trips</span>, <span class="va">leipzig_shp</span>, crs <span class="op">=</span> <span class="fl">25832</span>, spatial_type <span class="op">=</span> <span class="st">"originating"</span> <span class="op">)</span></span></code></pre></div>
<p>Using <code><a href="../reference/plot_mainmode_barchart.html">plot_mainmode_barchart()</a></code> on the 507 originating
trips, results in the following chart:</p>
<div class="figure">
<img src="Leipzig_modalsplit_originating.png" alt=""><p class="caption">Leipzig modal split - trips originating in project
area</p>
</div>
</div>
<div class="section level4">
<h4 id="comparison-plots">Comparison plots<a class="anchor" aria-label="anchor" href="#comparison-plots"></a>
</h4>
<p>In a next step we will compare the modal split of this base model
with the modal split of a scenario. To do this we need to load the
output_trips file from a scenario, e.g. this one. <a href="https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/leipzig/projects/namav/drt-outskirts/" class="external-link uri">https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/leipzig/projects/namav/drt-outskirts/</a></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#loading the scenario data</span></span>
<span><span class="va">output_trips_scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_output_trips.html">read_output_trips</a></span><span class="op">(</span><span class="va">trips_file_scenario_path</span>, n_max <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#filtering the scenario data</span></span>
<span><span class="va">trips_scenario_originating</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_filter_by_shape.html">process_filter_by_shape</a></span><span class="op">(</span><span class="va">output_trips_scenario</span>, <span class="va">leipzig_shp</span>, crs <span class="op">=</span> <span class="fl">25832</span>, spatial_type <span class="op">=</span> <span class="st">"originating"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#creating the comparison plot</span></span>
<span><span class="fu"><a href="../reference/plot_compare_mainmode_barchart.html">plot_compare_mainmode_barchart</a></span><span class="op">(</span><span class="va">trips_originating</span>, <span class="va">trips_scenario_originating</span><span class="op">)</span></span></code></pre></div>
<p>The resulting plot looks like this: <img src="./Leipzig_modalsplit_comparison.png" alt="Leipzig modal split comparison"></p>
</div>
<div class="section level4">
<h4 id="maps">Maps<a class="anchor" aria-label="anchor" href="#maps"></a>
</h4>
<p>The package also allows the plotting of spatial data. As an example
we can plot the trips originating in the project area to see where they
end.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_map_trips.html">plot_map_trips</a></span><span class="op">(</span><span class="va">trips_originating</span>, crs <span class="op">=</span> <span class="fl">25832</span><span class="op">)</span></span></code></pre></div>
<p>The result is an interactive map using leaflet, showing the places of
origin in blue and the destinations in red. (The following image is a
screenshot)</p>
<div class="figure">
<img src="Leipzig_map.png" alt=""><p class="caption">Leipzig - originating trips</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Billy Charlton, Oleksandr Soboliev, Johanna Bänsch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
